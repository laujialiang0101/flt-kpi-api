services:
  # Main API Service
  - type: web
    name: flt-kpi-api
    runtime: python
    plan: starter
    region: singapore
    autoDeploy: true
    buildCommand: pip install -r requirements.txt
    startCommand: uvicorn main:app --host 0.0.0.0 --port $PORT --loop asyncio
    envVars:
      - key: DB_HOST
        value: dpg-d4pr99je5dus73eb5730.singapore-postgres.render.com
      - key: DB_NAME
        value: flt_sales_commission_db
      - key: DB_USER
        value: flt_sales_commission_db_user
      - key: DB_PASSWORD
        sync: false
      - key: REFRESH_API_KEY
        sync: false
      - key: PUSH_API_KEY
        sync: false

  # Cron Job: MV Refresh every 30 min during business hours (8am-11pm MYT)
  - type: cron
    name: flt-mv-refresh
    runtime: python
    region: singapore
    schedule: "*/30 0-15 * * *"
    buildCommand: pip install requests
    startCommand: python cron_refresh.py

  # Cron Job: Morning Briefing at 8am MYT (0:00 UTC)
  - type: cron
    name: flt-morning-briefing
    runtime: python
    region: singapore
    schedule: "0 0 * * *"
    buildCommand: pip install requests
    startCommand: python cron_morning.py

  # Cron Job: Evening Recap at 10:30pm MYT (14:30 UTC)
  - type: cron
    name: flt-evening-recap
    runtime: python
    region: singapore
    schedule: "30 14 * * *"
    buildCommand: pip install requests
    startCommand: python cron_evening.py
